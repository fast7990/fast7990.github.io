<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网站链接关系图 - D3.js 可视化</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        
        /* 标题和控制面板样式 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 28px;
        }
        
        .stats {
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        /* 图表容器 */
        #graph-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            position: relative;
        }
        
        svg {
            width: 100%;
            height: 80vh;
        }
        
        /* 节点样式 */
        .node {
            cursor: pointer;
            stroke: white;
            stroke-width: 1.5px;
        }
        
        .node:hover {
            stroke: #2c3e50;
            stroke-width: 2.5px;
            filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.3));
        }
        
        /* 链接样式 */
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 1.5px;
        }
        
        /* 节点标签 */
        .node-label {
            font-size: 12px;
            text-anchor: middle;
            pointer-events: none;
            fill: #333;
            font-weight: bold;
            text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.8);
        }
        
        /* 工具提示 */
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            max-width: 300px;
            word-wrap: break-word;
            line-height: 1.4;
        }
        
        /* 图例 */
        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            font-size: 12px;
            z-index: 100;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>购物网站链接关系图</h1>
        
        <div class="stats">
            <span>节点数: <strong>11</strong></span> | 
            <span>链接数: <strong>19</strong></span>
        </div>
        
        <div class="controls">
            <button id="reset-btn">重置视图</button>
            <button id="zoom-in-btn">放大</button>
            <button id="zoom-out-btn">缩小</button>
            <button id="center-btn">居中</button>
        </div>
        
        <div id="graph-container">
            <svg id="graph-svg"></svg>
            
            <div class="legend">
                <h3>节点深度</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #69b3a2;"></div>
                    <span>深度 0 (首页)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #408080;"></div>
                    <span>深度 1</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #8080c0;"></div>
                    <span>深度 2</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #c08080;"></div>
                    <span>深度 3+</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // 节点和链接数据
        const nodes = [{"id":0,"name":"首页","url":"https://example.com","depth":0},{"id":1,"name":"产品详情页","url":"https://example.com/products","depth":1},{"id":2,"name":"登录页","url":"https://example.com/login","depth":1},{"id":3,"name":"注册页","url":"https://example.com/register","depth":1},{"id":4,"name":"产品详情页","url":"https://example.com/product/1","depth":2},{"id":5,"name":"产品详情页","url":"https://example.com/product/2","depth":2},{"id":6,"name":"用户中心","url":"https://example.com/user/profile","depth":2},{"id":7,"name":"购物车","url":"https://example.com/cart","depth":1},{"id":8,"name":"结账页","url":"https://example.com/checkout","depth":1},{"id":9,"name":"订单页","url":"https://example.com/order-confirm","depth":1},{"id":10,"name":"订单页","url":"https://example.com/user/orders","depth":2}];
        const links = [{"source":0,"target":1},{"source":0,"target":2},{"source":0,"target":3},{"source":1,"target":4},{"source":1,"target":5},{"source":2,"target":6},{"source":2,"target":7},{"source":3,"target":2},{"source":4,"target":7},{"source":4,"target":1},{"source":5,"target":7},{"source":5,"target":1},{"source":7,"target":8},{"source":7,"target":1},{"source":8,"target":9},{"source":8,"target":7},{"source":9,"target":10},{"source":10,"target":6},{"source":6,"target":2}];
        
        // 设置 SVG 尺寸
        const svg = d3.select("#graph-svg");
        const container = d3.select("#graph-container");
        let width = container.node().clientWidth;
        let height = container.node().clientHeight;
        
        // 创建缩放行为
        const zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });
        
        // 应用缩放
        svg.call(zoom);
        
        // 创建主组
        const g = svg.append("g");
        
        // 创建工具提示
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        
        // 创建力导向模拟
        const simulation = d3.forceSimulation(nodes)
            .force("link", d3.forceLink(links).id(d => d.id).distance(120))
            .force("charge", d3.forceManyBody().strength(-500))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(40));
        
        // 创建链接
        const link = g.append("g")
            .selectAll("line")
            .data(links)
            .enter().append("line")
            .attr("class", "link");
        
        // 创建节点
        const node = g.append("g")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", 30)
            .style("fill", d => {
                // 根据深度设置不同颜色
                const colors = ["#69b3a2", "#408080", "#8080c0", "#c08080"];
                return colors[d.depth % colors.length];
            })
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));
        
        // 添加节点标签
        const labels = g.append("g")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .attr("class", "node-label")
            .text(d => d.name);
        
        // 添加鼠标事件
        node.on("mouseover", (event, d) => {
            tooltip.transition()
                .duration(200)
                .style("opacity", 0.95);
            tooltip.html(
                "<strong>" + d.name + "</strong><br/>" +
                "<small>URL: " + d.url + "</small><br/>" +
                "<small>深度: " + d.depth + "</small>"
            )
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 28) + "px");
        })
        .on("mouseout", () => {
            tooltip.transition()
                .duration(500)
                .style("opacity", 0);
        });
        
        // 更新力导向模拟
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            
            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
            
            labels
                .attr("x", d => d.x)
                .attr("y", d => d.y + 5);
        });
        
        // 拖拽函数
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }
        
        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
        
        // 响应窗口大小变化
        function resize() {
            width = container.node().clientWidth;
            height = container.node().clientHeight;
            
            svg.attr("width", width).attr("height", height);
            simulation.force("center", d3.forceCenter(width / 2, height / 2));
            simulation.alpha(0.3).restart();
        }
        
        window.addEventListener("resize", resize);
        
        // 控制面板功能
        d3.select("#reset-btn").on("click", () => {
            svg.transition().duration(750).call(
                zoom.transform, d3.zoomIdentity
            );
            simulation.alpha(0.3).restart();
        });
        
        d3.select("#zoom-in-btn").on("click", () => {
            svg.transition().duration(750).call(
                zoom.scaleBy, 1.3
            );
        });
        
        d3.select("#zoom-out-btn").on("click", () => {
            svg.transition().duration(750).call(
                zoom.scaleBy, 1 / 1.3
            );
        });
        
        d3.select("#center-btn").on("click", () => {
            svg.transition().duration(750).call(
                zoom.transform, d3.zoomIdentity.translate(width / 2, height / 2).scale(1)
            );
        });
        
        // 初始化尺寸
        resize();
    </script>
</body>
</html>